# 2026-02-08 (토)

## 🎯 주요 작업: 딥바이 전략 대폭 개선

### 1. 트레일링 스톱 설정 변경
- 트레일링 시작: **1.5% → 3.5%** 로 상향
- UI에서 API로 설정값 가져오도록 수정

### 2. 딥바이 종목 동적 관리 (DB 기반)
- `deep_buy_targets` 테이블 신규 생성
- `TARGET_STOCKS` 하드코딩 → DB 기반으로 변경
- API: `GET /api/trading/deep-buy/targets`
- 프론트엔드에서 API로 종목 목록 로드 (중복 관리 제거)
- 미보유 종목(삼성중공업, 한화갤러리아) 제거

### 3. 동반매수 → 딥바이 연동 구현
```
동반매수 스캔 (외국인+기관 동시 매수)
    ↓
합격 종목 발견
    ↓
총자산 2.5% 금액 매수
    ↓
TARGET_STOCKS 자동 추가
    ↓
텔레그램 알림
```
- 주문가능금액 부족 시 스킵 (알림 전송)
- 최대 20개 제한 (`MAX_TARGETS = 20`)

### 4. 삼성전자/삼성전자우 특별 처리
- 트레일링 스톱 시 **총자산 10% 최소 보유**
- `SAMSUNG_CODES = ["005930", "005935"]`
- `SAMSUNG_MIN_HOLD_RATIO = 0.10`

### 5. 스마트 개미떨구기 판별
**기존**: 스톱가 도달 시 1회 측정 → 불안정

**개선**: 누적 측정 방식
- 고점 대비 **-0.5%부터 0.2% 간격**으로 측정 시작
- 스톱가(-1.5%) 도달까지 **5~6회 누적 측정**
- 판단 기준:
  - 평균 점수 ≥ 1.5 → 개미떨구기
  - 최대 점수 ≥ 3 → 개미떨구기

**측정 항목** (1회 ~90ms):
- 체결강도 ≥ 100% → +2점
- 체결강도 ≥ 80% → +1점  
- 매수잔량/매도잔량 ≥ 1.5 → +2점
- 매수잔량/매도잔량 ≥ 1.2 → +1점

### 6. 프론트엔드 개선
- Next.js rewrites로 API 프록시 설정 (3000 → 8000)
- 외부 접속 시 포트포워딩 3000만 필요

---

## 📊 현재 딥바이 설정 요약

| 설정 | 값 |
|------|-----|
| 트레일링 시작 | +3.5% |
| 트레일링 스톱 | 고점 -1.5% |
| 개미떨구기 측정 시작 | -0.5% |
| 측정 간격 | 0.2% |
| 삼성 최소 보유 | 총자산 10% |
| 딥바이 최대 종목 | 20개 |
| 동반매수 매수 금액 | 총자산 2.5% |

---

## 🔗 관련 파일
- `backend/services/simple_deep_buy.py` - 딥바이 전략
- `backend/services/samsung_deep_buy_service.py` - TARGET_STOCKS 관리
- `backend/services/institutional_buy_strategy_service.py` - 동반매수 연동
- `backend/models/deep_buy_target.py` - DB 모델
- `frontend/src/components/trading/SimpleDeepBuyCard.tsx` - UI
