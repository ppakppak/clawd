# 2026-02-09 (일)

## 주식 프로젝트 - WebSocket 연결 폭주 버그 수정

### 문제
- 브라우저 탭 1개인데 WebSocket 연결이 초당 20-30개씩 폭주
- 백엔드 서버 과부하로 자주 죽음

### 원인
1. `page.tsx`의 `connect()` 함수에서 기존 소켓 체크 없이 새 연결 생성
2. `onclose` 핸들러에서 정의 안 된 `handleBeforeUnload` 참조
3. `portfolio/[id]/page.tsx`에서 CONNECTING 상태 체크 누락

### 해결
- `page.tsx`: 기존 소켓 있으면 새 연결 안 만들도록 가드 추가
- `portfolio/[id]/page.tsx`: CONNECTING 상태도 가드에 포함
- `trading/page.tsx`: 가드 추가했다가 early return 문제로 제거
- `onclose`에서 잘못된 `removeEventListener` 제거

### 커밋
- `227c72f` - WebSocket 연결 폭주 버그 수정
- `be09672` - trading 페이지 가드 제거 + watchdog 락 파일 추가

## Watchdog 설정

### 위치
- 스크립트: `~/개발/stock/scripts/watchdog.sh`
- LaunchAgent: `~/Library/LaunchAgents/com.ppak.stock-watchdog.plist`

### 기능
- 10초마다 health check
- 실패 시 자동 재시작
- 텔레그램 알림 (성공/실패)
- 락 파일(`/tmp/stock-watchdog.lock`)로 중복 재시작 방지
- 재시작 후 15초 대기 후 체크

## 시뮬레이션 페이지 삭제
- `frontend/src/app/simulation/` 폴더 삭제 (사용 안 함)

## 댄스/스켈레톤 프로젝트 위치 (사용자가 찾던 것)
- `nex:/home/ppak/Dropbox/Company/hanbit/ssuim/KRDPY/` - OpenPose 기반 댄스 분석
- `nex:/home/ppak/Dropbox/Company/hanbit/ssuim/StreetDanceRecognition-master/` - 스트리트 댄스 인식
- `nex:/home/ppak/Dropbox/Company/hanbit/ssuim/EverybodyDanceNow_reproduce_pytorch/` - 댄스 모션 트랜스퍼
- `nex:/home/ppak/SynologyDrive/ykpark/kalmantech/vitpose_project/` - ViTPose 스켈레톤 추정

## 현재 상태 (00:30 기준)
- 백엔드: 정상 (146 연결, 안정적)
- 프론트엔드: 정상
- Watchdog: 활성화
- 내일 장 준비 완료
