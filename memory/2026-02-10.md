
## Stock 시스템 트러블슈팅 (08:50 ~ 09:15)

### 발생한 문제들
1. **잔고 조회 API 실패**: `INQR_DVSN` 파라미터 오류
   - 원인: KIS API가 `02` 대신 `01` 값을 요구
   - 해결: `kis_api_service.py`에서 `INQR_DVSN: "02"` → `"01"` 수정
   - 커밋: `bdaf9f7`

2. **KIS WebSocket 연결 실패**: `"ALREADY IN USE appkey"` 에러
   - 원인: Mac 재부팅 후 이전 WebSocket 세션이 KIS 서버에 남아있음
   - 결과: 실시간 시세 수신 불가 → 자동 매도 트리거 작동 안 함
   - 프론트엔드는 Balance API 30초 폴링으로 가격 표시 중

3. **삼성전자 매도 누락**: 09:00에 +4.38% 도달했으나 자동 매도 안 됨
   - 수동으로 1주 매도 실행 (주문번호: 0005406100, @168,000원)

### WebSocket 구조 (기억할 것)
- KIS ↔ 백엔드: 실시간 시세 수신 (H0STCNT0)
- 백엔드 ↔ 프론트엔드: 가격 브로드캐스트 (/ws)
- 두 연결은 별개! KIS 연결 실패해도 프론트엔드 WS는 연결 유지됨

### 미해결 (오전)
- KIS WebSocket 세션 자동 정리 대기 중 → 해결됨

---

## Stock 시스템 추가 작업 (10:30 ~ 18:30)

### 동반매수 전략 수정
1. **kis_api_service 오류 해결**: `buy_stock` 메서드 없음 → 코드 수정
2. **딥바이 카드 모든 종목 표시**: `load_all_targets_from_db()` 추가
3. **보유 종목 추가매수 금지**: 물타기 기능 비활성화 (69줄 삭제)
4. **재매수 개념 제거**: 미보유 종목은 모두 동등한 후보로 처리

### 딥바이 매도가 참조 로직 수정
- 문제: 과거 사이클의 매도가를 현재 포지션에 적용
- 해결: 현재 포지션 매수 이후의 매도만 참조
- `_load_last_sell_prices_from_db()` 개선

### 잘못된 DB 기록 정리
- 두산에너빌리티: 07:54 매도 기록 5개 삭제 (장전 시간 잘못 기록)

### 오늘 매매 결과
- 동반매수: 삼성중공업, 한화투자증권, 한화시스템, 두산에너빌리티 매수
- 삼성전자: 5주 매도 (15:09)

---

## Pipe Inspector 확인 (19:30)
- 서비스 정상 가동 (포트 5003, PID 571910)
- 로그 위치: `/tmp/backend_proxy.log` (프로젝트 폴더 아님)
- admin 계정 접속 확인
- Dataset 탭 분석: 다중 프로젝트 YOLO 데이터셋 빌드 기능

---

## 워치독 장외시간 비활성화 (21:00)
- 문제: 장외 시간에 서버가 36초마다 재시작 (하루 161회!)
- 원인: KIS WebSocket "ALREADY IN USE" 에러 → 워치독이 장애로 오인
- 해결: `watchdog.sh`에 장중 시간 체크 추가 (09:00~15:30만 활성화)
- 커밋: `8206aea`

---

## Chrome Remote Desktop 와이드 해상도 (21:30)
- 문제: nex에 물리 모니터(2560x1440) 연결 → 와이드 해상도 불가
- 시도: xrandr로 해상도 추가 → HDMI EDID 제한으로 실패
- 결론: 더미플러그 + HDMI 스위치 구매 추천
- 환경변수 추가: `CHROME_REMOTE_DESKTOP_DEFAULT_DESKTOP_SIZES`

---

## 오늘의 Git 커밋 요약
1. `afd2198` - 딥바이 trailing에 DB의 모든 대상 종목 자동 포함
2. `de76239` - 동반매수 보유 종목 추가매수 금지
3. `ca22fe0` - 재매수 로직 개선 (30일 내 전량 매도 종목)
4. `c59ee0e` - 재매수 개념 제거 (미보유 종목 동등 후보)
5. `e18cc11` - 딥바이 매도가 참조 로직 수정
6. `8206aea` - 워치독 장외시간 비활성화
